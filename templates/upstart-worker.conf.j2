start on starting {{ nodejs_app.service }}
stop on stopping {{ nodejs_app.service }}

respawn
respawn limit 10 5

setuid nobody
setgid nogroup

env PORT={{ nodejs_app.port|int + item|int - 1 }}
{% for k, v in nodejs_app.env.iteritems() %}
env {{ k }}='{{ v }}'
{% endfor %}

chdir {{ nodejs_app.dir }}
exec npm start >> {{ nodejs_app.logdir }}/{{ nodejs_app.service }}.log 2>&1
